# -----------------------------------------------------------------------------
# Machine-Specific Configurations for String Driver
# -----------------------------------------------------------------------------
# The script will use the output of 'uname -n' (hostname) to look up
# the correct settings. Add a new block for each new machine.
# -----------------------------------------------------------------------------

# Configuration is organized by OS and then hostname
# This allows for easy management of settings across different machines

# macOS specific configurations
macOS:
  Gregorys-Air.lan:
    TERMINAL: /Applications/Terminal.app
    KILLALL_PATH: /usr/bin/pkill
    CURL_PATH: /usr/bin/curl
    SHMEM_PATH: /tmp
    CONTROL_FILE: /tmp/audio_control
    DB_TABLE: none
    STRING_NUM: 0

# Ubuntu specific configurations
Ubuntu:
  gregory-MacBookAir:
    TERMINAL: xterm
    KILLALL_PATH: /usr/bin/killall
    SHMEM_PATH: /dev/shm
    CONTROL_FILE: /dev/shm/audio_control
    DB_TABLE: none
    STRING_NUM: 4
    ARD_NUM_STEPPERS: 13 #number of steppers in arduino code
    ARD_PORT: /dev/ttyUSB0
    X_STEP_INDEX: 0
    Z_FIRST_INDEX: 1
    X_MAX_POS: 2600 #dummy value
    TUNER_FIRST_INDEX: 9 #simulated tuners
    # TUNER_FIRST_INDEX: 0
    # ARD_T_NUM_STEPPERS: 6
    ARD_T_PORT: null
    # Binary sizes for Pico (RP2040)
    # ARD_T_INT_BYTES: 4
    # ARD_T_LONG_BYTES: 4
    # ARD_T_FLOAT_BYTES: 4
    # ARD_T_DOUBLE_BYTES: 8
    
  gregory-Latitude-5550:
    TERMINAL: xterm
    KILLALL_PATH: /usr/bin/killall
    SHMEM_PATH: /dev/shm
    CONTROL_FILE: /dev/shm/audio_control
    DB_TABLE: none
    GPIO_ENABLED: false
    STRING_NUM: 0
    ARD_NUM_STEPPERS: 0

# Raspberry Pi specific configurations
RaspberryPi:
  stringdriver-3:
    TERMINAL: xterm
    KILLALL_PATH: /usr/bin/killall
    SHMEM_PATH: /dev/shm
    CONTROL_FILE: /dev/shm/audio_control
    DB_TABLE: RND
    GPIO_ENABLED: true
    GPIO_LIBRARY: gpiod
    GPIO_COMPONENTS:
      Z_TOUCH_PINS: [8, 17, 18, 27, 10, 13, 24, 21] # 8 pins for 4 strings
    GPIO_MAX_STEPS: 1550 # For guitar setup
    STRING_NUM: 4
    # Carriage firmware currently lacks a real X-axis stepper; index 0 is kept
    # as a placeholder so software arrays line up.
    X_STEP_INDEX: 0
    X_MAX_POS: 0 #dummy value
    Z_FIRST_INDEX: 1
    # No tuners on stringdriver-3 - omit TUNER_FIRST_INDEX so no tuners are created
    ARD_NUM_STEPPERS: 13
    ARD_PORT: /dev/ttyUSB0
    z_up_step: 2
    z_down_step: -2
    
  stringdriver-2:
    TERMINAL: xterm
    KILLALL_PATH: /usr/bin/killall
    SHMEM_PATH: /dev/shm
    CONTROL_FILE: /dev/shm/audio_control
    DB_TABLE: data_2024
    GPIO_ENABLED: true
    GPIO_LIBRARY: gpiozero
    GPIO_COMPONENTS:
      Z_TOUCH_PINS: [8, 17, 18, 27, 10, 13, 24, 21, 5, 19, 11, 20] # 12 pins
      X_HOME_PIN: 16
      X_AWAY_PIN: 26
    GPIO_MAX_STEPS: 1550 # For guitar setup
    STRING_NUM: 6
    # Stepper index map (13-step carriage board + 6-step tuner board)
    X_STEP_INDEX: 0
    Z_FIRST_INDEX: 1
    # Tuners live on the separate ARD_T board and are numbered 0-5 there.
    TUNER_FIRST_INDEX: 0
    ARD_NUM_STEPPERS: 13
    ARD_PORT: /dev/ttyACM0
    ARD_T_NUM_STEPPERS: 6
    ARD_T_PORT: /dev/ttyACM1
    X_MAX_POS: 2600
    z_up_step: 2
    z_down_step: -2

  stringdriver-1:
    TERMINAL: xterm
    KILLALL_PATH: /usr/bin/killall
    SHMEM_PATH: /dev/shm
    CONTROL_FILE: /dev/shm/audio_control
    DB_TABLE: data_2022
    GPIO_ENABLED: true
    GPIO_LIBRARY: gpiozero
    GPIO_COMPONENTS:
      Z_TOUCH_PINS: [6, 26, 19, 5]
      X_LIMIT_PIN: 16
      ROTARY_ENCODER_PINS: { A: 17, B: 27 }
      DISTANCE_SENSOR_PINS: { TRIG: 23, ECHO: 24 }
    GPIO_MAX_STEPS: 2396 
    STRING_NUM: 2
    # Stepper index mapping for carriage Arduino (7-step firmware):
    # tuners 0-1, X 2, Z touch pairs 3-6.
    X_STEP_INDEX: 2
    Z_FIRST_INDEX: 3
    TUNER_FIRST_INDEX: 0
    # Arduino firmware on stringdriver-1 uses the original 7-step command set
    # (tuner1, tuner2, gantry, input/output coils).  Declare this explicitly
    # so stepper_Commands builds the correct protocol table.
    ARD_NUM_STEPPERS: 7          # number of stepper positions reported by firmware
    ARD_PORT: /dev/ttyACM0
    X_MAX_POS: 2396
    z_up_step: 2
    z_down_step: -2

# Common configurations (applies to all environments unless overridden)
common:
  PREDICTOR_PATH: predictors/
  CODE_PATH: code/
  SHOW_PLOT: true
  JACK_WAIT_TIMEOUT: 30
  JACK_WAIT_INTERVAL: 1
  JACK_SETTLE_TIME: 2
  SCRIPT_LOOP_INTERVAL: 10
